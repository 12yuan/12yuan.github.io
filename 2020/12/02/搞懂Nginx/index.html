<!DOCTYPE html>
<html  lang="zh-CN" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <meta name="description" content="IT小猪">
  <link rel="icon" href="/img/Kaze.png">
  <title>弄懂nginx</title>
  
  
  <meta property="og:title" content="弄懂nginx">
  
  
  <meta property="og:url" content="https://12yuan.github.io/2020/12/02/%E6%90%9E%E6%87%82Nginx/index.html">
  
  
  <meta property="og:img" content="/img/Kaze.png">
  
  
  
  <meta property="og:type" content="article">
  <meta property="og:article:published_time" content="2020-12-02">
  <meta property="og:article:modified_time" content="2020-12-02">
  <meta property="og:article:author" content="theme-kaze">
  
  
  <meta property="og:article:tag" content="nginx">
  
  
  
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
<link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">

  
  
  
  
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/img/Kaze.png" alt="logo">
      
      <span class="navbar-logo-dsc">theme-kaze demo</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">
    
    首页
    
    </a>
    
    <a href="/archives" class="navbar-menu-item">
    
    归档
    
    </a>
    
    <a href="/tags" class="navbar-menu-item">
    
    标签
    
    </a>
    
    <a href="/categories" class="navbar-menu-item">
    
    分类
    
    </a>
    
    <a href="/about" class="navbar-menu-item">
    
    关于
    
    </a>
    
    <a href="/links" class="navbar-menu-item">
    
    友链
    
    </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
    <a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size: 1.2rem; font-weight: 400;"></i></a>
  </div>
</nav>
    
    <div id="local-search" style="display: none;">
      <input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容...">
      <div id="search-content"></div>
    </div>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      弄懂nginx
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2020-12-02T05:49:10.366Z">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2020-12-02</span>
    </time>
    
    <span class="dot"></span>
    
    <a href="/categories/Linux/" class="post-meta-link">Linux</a>
    
    
    
    <span class="dot"></span>
    <span>2.6k 字</span>
    
  </div>
  
  <div class="post-meta post-show-meta" style="margin-top: -10px;">
    <div style="display: flex; align-items: center;">
      <i class="iconfont icon-biaoqian" style="margin-right: 2px; font-size: 1.15rem;"></i>
      
      
        <a href="/tags/nginx/" class="post-meta-link">nginx</a>
      
    </div>
  </div>
  
  </header>
  <div id="section" class="post-content">
    <p>[TOC]</p>
<h1 id="1-Nginx知识网结构图"><a href="#1-Nginx知识网结构图" class="headerlink" title="1.Nginx知识网结构图"></a>1.Nginx知识网结构图</h1><p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135224.png" alt="微信图片_20201202135224" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135224.png" class="lozad post-image"></p>
<p>Nginx是一个高性能的HTTP和反向代理服务器，特点是占用内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好</p>
<p>nginx专为性能优化而开发，性能是其最重要的要求，十分注重效率，有报告nginx能支持高达50000个并发连接数</p>
<h2 id="1-1反向代理"><a href="#1-1反向代理" class="headerlink" title="1.1反向代理"></a>1.1反向代理</h2><p><strong>正向代理</strong>正向代理：局域网中的电脑用户想要直接访问网络是不可行的，只能通过代理服务器来访问，这种代理服务就被称为正向代理。</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135518.png" alt="微信图片_20201202135518" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135518.png" class="lozad post-image"></p>
<p><strong>反向代理</strong>反向代理：客户端无法感知代理，因为客户端访问网络不需要配置，只要把请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据，然后再返回到客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器IP地址</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135551.png" alt="微信图片_20201202135551" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135551.png" class="lozad post-image"></p>
<h2 id="1-2负载均衡"><a href="#1-2负载均衡" class="headerlink" title="1.2负载均衡"></a>1.2负载均衡</h2><p>客户端发送多个请求到服务器，服务器处理请求，有一些可能要与数据库进行狡猾，服务器处理完毕之后，再将结果返回给客户端</p>
<p>普通请求和响应过程</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135629.png" alt="微信图片_20201202135629" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135629.png" class="lozad post-image"></p>
<p>但是随着信息数量增长，访问量和数据量飞速增长，普通架构无法满足现在的需求</p>
<p>我们首先想到的是升级服务器配置，可以由于摩尔定律的日益失效，单纯从硬件提升性能已经逐渐不可取了，怎么解决这种需求呢？</p>
<p>我们可以增加服务器的数量，构建集群，将请求分发到各个服务器上，将原来请求集中到单个服务器的情况改为请求分发到多个服务器，也就是我们说的负载均衡</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135707.png" alt="微信图片_20201202135707" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135707.png" class="lozad post-image"></p>
<p>假设有15个请求发送到代理服务器，那么由代理服务器根据服务器数量，平均分配，每个服务器处理5个请求，这个过程就叫做负载均衡</p>
<h2 id="1-3动静分离"><a href="#1-3动静分离" class="headerlink" title="1.3动静分离"></a>1.3动静分离</h2><p>为了加快网站的解析速度，可以把动态页面和静态页面交给不同的服务器来解析，加快解析的速度，降低由单个服务器的压力</p>
<p>动静分离之前的状态</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135822.png" alt="微信图片_20201202135822" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135822.png" class="lozad post-image">动静分离之后</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135826.png" alt="微信图片_20201202135826" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202135826.png" class="lozad post-image"></p>
<h1 id="2-nginx如何在linux安装"><a href="#2-nginx如何在linux安装" class="headerlink" title="2. nginx如何在linux安装"></a>2. nginx如何在linux安装</h1><h1 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h1><p><strong>linux系统</strong><br>CentOS 7 64位</p>
<p>下载以下安装包，用xftp放入linux系统</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20200716155141635.png" alt="20200716155141635" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20200716155141635.png" class="lozad post-image"></p>
<p>第一步：安装pcre依赖</p>
<ul>
<li><p>解压压缩文件，进入解压之后的目录执行./configure，然后执行make &amp;&amp; make install</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20200716155524685.png" alt="20200716155524685" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20200716155524685.png" class="lozad post-image"></p>
</li>
<li><p>查看是否安装成功</p>
<pre class="highlight"><span class="line">[root@localhost pcre-8.37]# pcre-config --version</span><br></pre>

</li>
</ul>
<p>第二步：安装其他依赖</p>
<pre class="highlight"><span class="line">[root@localhost pcre-8.37]# yum -y make zlib zlib-devel gcc-c++ libtool openssl openssl-devel</span><br></pre>

<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20200716155704129.png" alt="20200716155704129" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20200716155704129.png" class="lozad post-image"></p>
<p>第三步：安装nginx</p>
<ul>
<li>解压nginx，进入nginx目录</li>
<li>执行make &amp;&amp; make install</li>
<li>去sbin文件夹下启动nginx</li>
</ul>
<pre class="highlight"><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br></pre>

<p>检查是否启动成功</p>
<pre class="highlight"><span class="line">[root@localhost sbin]# ps -ef|grep nginx</span><br></pre>

<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/2020071615595622.png" alt="2020071615595622" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/2020071615595622.png" class="lozad post-image"></p>
<h1 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h1><p><strong>linux系统</strong><br>Red Hat Enterprise Linux Server release 6.5 (Santiago)</p>
<h1 id="提前需要准备的"><a href="#提前需要准备的" class="headerlink" title="提前需要准备的"></a>提前需要准备的</h1><p>1.nginx 源码 ： <a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a><br>2.yum<br>安装教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/yujing1314/article/details/97237644">https://blog.csdn.net/yujing1314/article/details/97237644</a><br>3.gcc-c++</p>
<pre class="highlight"><span class="line">[root@localhost ~]yum install gcc-c++</span><br></pre>

<p>4.第三方开发包</p>
<pre class="highlight"><span class="line">[root@localhost ~]yum install -y pcre pcre-devel</span><br><span class="line"></span><br><span class="line">[root@localhost ~]yum install -y zlib zlib-devel</span><br><span class="line"></span><br><span class="line">[root@localhost ~]yum install -y openssl openssl-devel</span><br></pre>

<h1 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h1><h3 id="第一步：把nginx的源码包上传到linux系统"><a href="#第一步：把nginx的源码包上传到linux系统" class="headerlink" title="第一步：把nginx的源码包上传到linux系统"></a>第一步：把nginx的源码包上传到linux系统</h3><p>我使用的SecureCRT的sftp文件传输，直接把文件拖进去就OK了</p>
<h3 id="第二步：解压缩"><a href="#第二步：解压缩" class="headerlink" title="第二步：解压缩"></a>第二步：解压缩</h3><pre class="highlight"><span class="line">[root@localhost ~]tar zxf nginx-1.8.0.tar.gz</span><br></pre>

<h3 id="第三步：使用configure命令创建一makeFile文件。"><a href="#第三步：使用configure命令创建一makeFile文件。" class="headerlink" title="第三步：使用configure命令创建一makeFile文件。"></a>第三步：使用configure命令创建一makeFile文件。</h3><pre class="highlight"><span class="line">.&#x2F;configure</span><br><span class="line">–prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx</span><br><span class="line">–pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx&#x2F;nginx.pid</span><br><span class="line">–lock-path&#x3D;&#x2F;var&#x2F;lock&#x2F;nginx.lock</span><br><span class="line">–error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</span><br><span class="line">–http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br><span class="line">–with-http_gzip_static_module</span><br><span class="line">–http-client-body-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;client</span><br><span class="line">–http-proxy-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;proxy</span><br><span class="line">–http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;fastcgi</span><br><span class="line">–http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;uwsgi</span><br><span class="line">–http-scgi-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;scgi</span><br></pre>

<h3 id="第四步-上一步可能会报错，因为缺少temp文件，如下创建即可"><a href="#第四步-上一步可能会报错，因为缺少temp文件，如下创建即可" class="headerlink" title="第四步 上一步可能会报错，因为缺少temp文件，如下创建即可"></a>第四步 上一步可能会报错，因为缺少temp文件，如下创建即可</h3><pre class="highlight"><span class="line">[root@localhost sbin]# mkdir &#x2F;var&#x2F;temp&#x2F;nginx&#x2F;client -p</span><br></pre>



<h3 id="第五步-make"><a href="#第五步-make" class="headerlink" title="第五步 make"></a>第五步 make</h3><p>直接输入 make</p>
<h3 id="第六步-make-install"><a href="#第六步-make-install" class="headerlink" title="第六步 make install"></a>第六步 make install</h3><p>直接输入 make install</p>
<h1 id="开启nginx"><a href="#开启nginx" class="headerlink" title="开启nginx"></a>开启nginx</h1><pre class="highlight"><span class="line">[root@localhost sbin]# .&#x2F;nginx</span><br></pre>

<p>如何查看进程</p>
<pre class="highlight"><span class="line">[root@bogon stefan]# ps aux|grep nginx</span><br></pre>

<p>关闭nginx：</p>
<pre class="highlight"><span class="line">[root@localhost sbin]# .&#x2F;nginx -s stop</span><br></pre>

<p>推荐使用：</p>
<pre class="highlight"><span class="line">[root@localhost sbin]# .&#x2F;nginx -s quit</span><br></pre>

<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>输入你虚拟机的ip，如下图就成功了</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20190725155906841.png" alt="20190725155906841" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/20190725155906841.png" class="lozad post-image"></p>
<p>如果测试失败，注意查看虚拟机防火墙是否关闭</p>
<h1 id="3-nginx常用命令"><a href="#3-nginx常用命令" class="headerlink" title="3. nginx常用命令"></a>3. nginx常用命令</h1><p>查看版本</p>
<pre class="highlight"><span class="line">.&#x2F;nginx -v</span><br></pre>

<p>启动</p>
<pre class="highlight"><span class="line">.&#x2F;nginx</span><br></pre>

<p>关闭（有两种方式，推荐使用 ./nginx -s quit）</p>
<pre class="highlight"><span class="line">.&#x2F;nginx -s stop .&#x2F;nginx -s quit</span><br></pre>

<p>重新加载nginx配置</p>
<pre class="highlight"><span class="line">.&#x2F;nginx -s reload</span><br></pre>

<h1 id="4-nginx的配置文件"><a href="#4-nginx的配置文件" class="headerlink" title="4.nginx的配置文件"></a>4.nginx的配置文件</h1><p>配置文件分三部分组成</p>
<p>全局块 从配置文件开始到events块之间，主要是设置一些影响nginx服务器整体运行的配置指令</p>
<p>并发处理服务的配置，值越大，可以支持的并发处理量越多，但是会受到硬件、软件等设备的制约</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202140915.png" alt="微信图片_20201202140915" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202140915.png" class="lozad post-image"></p>
<p>events块 影响nginx服务器与用户的网络连接，常用的设置包括是否开启对多workprocess下的网络连接进行序列化，是否允许同时接收多个网络连接等等</p>
<p>支持的最大连接数</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202140934.png" alt="微信图片_20201202140934" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202140934.png" class="lozad post-image"></p>
<p>http块 诸如反向代理和负载均衡都在此配置</p>
<p><strong>location指令说明</strong></p>
<ul>
<li><p>该语法用来匹配url，语法如下</p>
<pre class="highlight"><span class="line">location[ &#x3D; | ~ | ~* | ^~] url&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>



</li>
</ul>
<ol>
<li>=:用于不含正则表达式的url前，要求字符串与url严格匹配，匹配成功就停止向下搜索并处理请求</li>
<li>~：用于表示url包含正则表达式，并且区分大小写。</li>
<li>~*：用于表示url包含正则表达式，并且不区分大瞎写</li>
<li>^~：用于不含正则表达式的url前，要求ngin服务器找到表示url和字符串匹配度最高的location后，立即使用此location处理请求，而不再匹配</li>
<li>如果有url包含正则表达式，不需要有~开头标识</li>
</ol>
<h2 id="4-1-反向代理实战"><a href="#4-1-反向代理实战" class="headerlink" title="4.1 反向代理实战"></a>4.1 反向代理实战</h2><p><strong>配置反向代理</strong>目的：在浏览器地址栏输入地址<a target="_blank" rel="noopener" href="http://www.123.com跳转linux系统tomcat主页面/">www.123.com跳转linux系统tomcat主页面</a></p>
<p>具体实现 先配置tomcat：因为比较简单，此处不再赘叙 并在windows访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141432.png" alt="微信图片_20201202141432" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141432.png" class="lozad post-image"></p>
<p>具体流程</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141451.png" alt="微信图片_20201202141451" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141451.png" class="lozad post-image"></p>
<p>修改之前</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141513.png" alt="微信图片_20201202141513" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141513.png" class="lozad post-image"></p>
<p>配置</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141546.png" alt="微信图片_20201202141546" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141546.png" class="lozad post-image"></p>
<p>再次访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141559.png" alt="微信图片_20201202141559" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141559.png" class="lozad post-image"></p>
<p><strong>反向代理2</strong></p>
<p>1.目标 访问<a target="_blank" rel="noopener" href="http://192.168.25.132:9001/edu/">http://192.168.25.132:9001/edu/</a> 直接跳转到192.168.25.132:8080 访问<a target="_blank" rel="noopener" href="http://192.168.25.132:9001/vod/">http://192.168.25.132:9001/vod/</a> 直接跳转到192.168.25.132:8081</p>
<p>2.准备 配置两个tomcat，端口分别为8080和8081，都可以访问，端口修改配置文件即可。</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141621.png" alt="微信图片_20201202141621" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141621.png" class="lozad post-image"></p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141632.png" alt="微信图片_20201202141632" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141632.png" class="lozad post-image"></p>
<p>新建文件内容分别添加8080！！！和8081！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141653.png" alt="微信图片_20201202141653" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141653.png" class="lozad post-image"></p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141707.png" alt="微信图片_20201202141707" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141707.png" class="lozad post-image"></p>
<p>响应如下</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141724.png" alt="微信图片_20201202141724" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141724.png" class="lozad post-image"></p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141736.png" alt="微信图片_20201202141736" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141736.png" class="lozad post-image"></p>
<p>3.具体配置</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141803.png" alt="微信图片_20201202141803" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141803.png" class="lozad post-image"></p>
<p>重新加载nginx</p>
<p>./nginx -s reload</p>
<p>访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141833.png" alt="微信图片_20201202141833" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141833.png" class="lozad post-image"></p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141843.png" alt="微信图片_20201202141843" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141843.png" class="lozad post-image"></p>
<p>实现了同一个端口代理，通过edu和vod路径的切换显示不同的页面</p>
<h2 id="4-2-反向代理小结"><a href="#4-2-反向代理小结" class="headerlink" title="4.2 反向代理小结"></a>4.2 反向代理小结</h2><p>第一个例子：浏览器访问<a target="_blank" rel="noopener" href="http://www.123.com,由host文件解析/">www.123.com，由host文件解析</a> 出服务器ip地址</p>
<p>192.168.25.132 <a target="_blank" rel="noopener" href="http://www.123.com/">www.123.com</a> 然后默认访问80端口，而通过nginx监听80端口代理到本地的8080端口上，从而实现了访问<a target="_blank" rel="noopener" href="http://www.123.com,最终转发到tomcat/">www.123.com，最终转发到tomcat</a> 8080上去</p>
<p>第二个例子：访问<a target="_blank" rel="noopener" href="http://192.168.25.132:9001/edu/">http://192.168.25.132:9001/edu/</a> 直接跳转到192.168.25.132:8080 访问<a target="_blank" rel="noopener" href="http://192.168.25.132:9001/vod/">http://192.168.25.132:9001/vod/</a> 直接跳转到192.168.25.132:8081</p>
<p>实际上就是通过nginx监听9001端口，然后通过正则表达式选择转发到8080还是8081的tomcat上去</p>
<h2 id="4-3-负载均衡实战"><a href="#4-3-负载均衡实战" class="headerlink" title="4.3 负载均衡实战"></a>4.3 负载均衡实战</h2><p>1.修改nginx.conf</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141914.png" alt="微信图片_20201202141914" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202141914.png" class="lozad post-image"></p>
<p>2.重启nginx</p>
<pre class="highlight"><span class="line">.&#x2F;nginx -s reload</span><br></pre>

<p>3.在8081的tomcat的webapps文件夹下新建edu文件夹和a.html文件，填写内容为8081！！！！</p>
<p>4.在地址栏回车，就会分发到不同的tomcat服器上</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142007.png" alt="微信图片_20201202142007" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142007.png" class="lozad post-image"></p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142038.png" alt="微信图片_20201202142038" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142038.png" class="lozad post-image"></p>
<p>3.负载均衡方式</p>
<ul>
<li><p>轮询（默认）</p>
</li>
<li><p>weight，代表权，权越高优先级越高</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142112.png" alt="微信图片_20201202142112" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142112.png" class="lozad post-image"></p>
</li>
<li><p>fair，按后端服务器的响应时间来分配请求，相应时间短的优先分配</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142127.png" alt="微信图片_20201202142127" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142127.png" class="lozad post-image"></p>
</li>
<li><p>ip_hash,每个请求按照访问ip的hash结果分配，这样每一个访客固定的访问一个后端服务器，可以解决session 的问题</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142138.png" alt="微信图片_20201202142138" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142138.png" class="lozad post-image"></p>
<h2 id="4-4-动静分离实战"><a href="#4-4-动静分离实战" class="headerlink" title="4.4 动静分离实战"></a>4.4 动静分离实战</h2><p><strong>什么是动静分离</strong>把动态请求和静态请求分开，不是讲动态页面和静态页面物理分离，可以理解为nginx处理静态页面，tomcat处理动态页面</p>
<p>动静分离大致分为两种：一、纯粹将静态文件独立成单独域名放在独立的服务器上，也是目前主流方案；二、将动态跟静态文件混合在一起发布，通过nginx分开</p>
<p><strong>动静分离图析</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142229.jpg" alt="微信图片_20201202142229" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142229.jpg" class="lozad post-image"></p>
<p><strong>实战准备</strong>准备静态文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142252.png" alt="微信图片_20201202142252" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142252.png" class="lozad post-image"></p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142302.png" alt="微信图片_20201202142302" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142302.png" class="lozad post-image"></p>
<p>配置nginx</p>
<p><img src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142342.png" alt="微信图片_20201202142342" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/gh/12yuan/12yuan.github.io/image_file/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201202142342.png" class="lozad post-image"></p>
<h1 id="5-nginx高可用"><a href="#5-nginx高可用" class="headerlink" title="5.nginx高可用"></a>5.nginx高可用</h1><p>如果nginx出现问题<img src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGKg0O3ZMdmAxziayZyTjBjBLNpOvmmA9eymmTpPic3ovCjvDtNHTSILOw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGKg0O3ZMdmAxziayZyTjBjBLNpOvmmA9eymmTpPic3ovCjvDtNHTSILOw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" class="lozad post-image">解决办法<img src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMG9WB5UXicrYhJ1ibagcpnQwicxxiaVAD2LDrhap2YUTQMoLflNZicHn1teCQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMG9WB5UXicrYhJ1ibagcpnQwicxxiaVAD2LDrhap2YUTQMoLflNZicHn1teCQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" class="lozad post-image">前期准备</p>
<ol>
<li>两台nginx服务器</li>
<li>安装keepalived</li>
<li>虚拟ip</li>
</ol>
<h2 id="5-1安装keepalived"><a href="#5-1安装keepalived" class="headerlink" title="5.1安装keepalived"></a>5.1安装keepalived</h2><pre class="highlight"><span class="line">[root@192 usr]# yum install keepalived -y</span><br><span class="line">[root@192 usr]# rpm -q -a keepalived</span><br><span class="line">keepalived-1.3.5-16.el7.x86_64</span><br></pre>

<p>修改配置文件</p>
<pre class="highlight"><span class="line">[root@192 keepalived]# cd &#x2F;etc&#x2F;keepalived</span><br><span class="line">[root@192 keepalived]# vi keepalived.conf </span><br></pre>

<p>分别将如下配置文件复制粘贴，覆盖掉keepalived.conf 虚拟ip为192.168.25.50</p>
<blockquote>
<p>对应主机ip需要修改的是 smtp_server 192.168.25.147（主）smtp_server 192.168.25.147（备） state MASTER（主） state BACKUP（备）</p>
</blockquote>
<pre class="highlight"><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 192.168.25.147</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id LVS_DEVEL # 访问的主机地址</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">  script &quot;&#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx_check.sh&quot;  # 检测文件的地址</span><br><span class="line">  interval 2   # 检测脚本执行的间隔</span><br><span class="line">  weight 2   # 权重</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP    # 主机MASTER、备机BACKUP    </span><br><span class="line">    interface ens33   # 网卡</span><br><span class="line">    virtual_router_id 51 # 同一组需一致</span><br><span class="line">    priority 90  # 访问优先级，主机值较大，备机较小</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.25.50  # 虚拟ip</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>

<p>启动</p>
<pre class="highlight"><span class="line">[root@192 sbin]# systemctl start keepalived.service</span><br></pre>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGdUyPiakLIjTI9VLaC9wh7acAxxfe6ickx9FjwIAZfzPkYQ7AibNp88ib2g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGdUyPiakLIjTI9VLaC9wh7acAxxfe6ickx9FjwIAZfzPkYQ7AibNp88ib2g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" class="lozad post-image"></p>
<p>访问虚拟ip成功<img src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGmjyJggLS1TabIO8wuaoHN7wnO8IUKTTIrVucOpJU2apHzZoMY86lfA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGmjyJggLS1TabIO8wuaoHN7wnO8IUKTTIrVucOpJU2apHzZoMY86lfA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" class="lozad post-image">关闭主机147的nginx和keepalived，发现仍然可以访问</p>
<h1 id="6-原理解析"><a href="#6-原理解析" class="headerlink" title="6.原理解析"></a>6.原理解析</h1><p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGFYbbK07IfMJejrkpqCfrjvkScrLhDzI5aTO5qFibvbvlwV26vicLgLDw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGFYbbK07IfMJejrkpqCfrjvkScrLhDzI5aTO5qFibvbvlwV26vicLgLDw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" class="lozad post-image">如下图，就是启动了一个master，一个worker，master是管理员，worker是具体工作的进程<img src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGvkLicZf7fKz7SH0ALhhIj978VOxibuHEXan899icibJkvJFz4z3Tteibz3w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMGvkLicZf7fKz7SH0ALhhIj978VOxibuHEXan899icibJkvJFz4z3Tteibz3w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" class="lozad post-image">worker如何工作<img src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMG3kL7OxpLg1szSncR2FiaHysMQf7Jjz4uFibib38qOaicW7ibdDwy7QzvTQg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://mmbiz.qpic.cn/mmbiz_png/YrLz7nDONjFI51tPyzml03ydQFiaSicPMG3kL7OxpLg1szSncR2FiaHysMQf7Jjz4uFibib38qOaicW7ibdDwy7QzvTQg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" class="lozad post-image"></p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul>
<li>worker数应该和CPU数相等</li>
<li>一个master多个worker可以使用热部署，同时worker是独立的，一个挂了不会影响其他的</li>
</ul>

  </div>
  <div>
  
  <div class="post-note note-warning copyright" style="margin-top: 42px">
    <p><span style="font-weight: bold;">作者：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://12yuan.github.io/about">theme-kaze</a></p>
    <p><span style="font-weight: bold;">文章链接：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://12yuan.github.io/2020/12/02/%E6%90%9E%E6%87%82Nginx/">https://12yuan.github.io/2020/12/02/%E6%90%9E%E6%87%82Nginx/</a></p>
    <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
  </div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/2020/12/03/Redis 的 8 大数据类型/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">上一篇</div>
        
        <div class="nav-title">Redis </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/2020/11/26/hexo搭建个人博客/" class="nav-link">
      <div>
        <div class="nav-label">下一篇</div>
        
        <div class="nav-title">hexo框架搭建个人博客 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Nginx%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="toc-text">1.Nginx知识网结构图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-text">1.1反向代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">1.2负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="toc-text">1.3动静分离</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-nginx%E5%A6%82%E4%BD%95%E5%9C%A8linux%E5%AE%89%E8%A3%85"><span class="toc-text">2. nginx如何在linux安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D"><span class="toc-text">第一种</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D"><span class="toc-text">第二种</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E5%89%8D%E9%9C%80%E8%A6%81%E5%87%86%E5%A4%87%E7%9A%84"><span class="toc-text">提前需要准备的</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-text">安装步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%8A%8Anginx%E7%9A%84%E6%BA%90%E7%A0%81%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%88%B0linux%E7%B3%BB%E7%BB%9F"><span class="toc-text">第一步：把nginx的源码包上传到linux系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%A7%A3%E5%8E%8B%E7%BC%A9"><span class="toc-text">第二步：解压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BD%BF%E7%94%A8configure%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E4%B8%80makeFile%E6%96%87%E4%BB%B6%E3%80%82"><span class="toc-text">第三步：使用configure命令创建一makeFile文件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5-%E4%B8%8A%E4%B8%80%E6%AD%A5%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%8A%A5%E9%94%99%EF%BC%8C%E5%9B%A0%E4%B8%BA%E7%BC%BA%E5%B0%91temp%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%88%9B%E5%BB%BA%E5%8D%B3%E5%8F%AF"><span class="toc-text">第四步 上一步可能会报错，因为缺少temp文件，如下创建即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5-make"><span class="toc-text">第五步 make</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5-make-install"><span class="toc-text">第六步 make install</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AFnginx"><span class="toc-text">开启nginx</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-nginx%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3. nginx常用命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-nginx%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">4.nginx的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98"><span class="toc-text">4.1 反向代理实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%B0%8F%E7%BB%93"><span class="toc-text">4.2 反向代理小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E6%88%98"><span class="toc-text">4.3 负载均衡实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%AE%9E%E6%88%98"><span class="toc-text">4.4 动静分离实战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-nginx%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-text">5.nginx高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E5%AE%89%E8%A3%85keepalived"><span class="toc-text">5.1安装keepalived</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-text">6.原理解析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-text">小结</span></a></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/img/Kaze.png" class="author-img">

<p class="author-name">theme-kaze</p>
<p class="author-description">designed by theme-kaze</p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>6</span>
    <span>文章</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>3</span>
    <span>分类</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>7</span>
    <span>标签</span>
  </a>
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Nginx%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="toc-text">1.Nginx知识网结构图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-text">1.1反向代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">1.2负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="toc-text">1.3动静分离</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-nginx%E5%A6%82%E4%BD%95%E5%9C%A8linux%E5%AE%89%E8%A3%85"><span class="toc-text">2. nginx如何在linux安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D"><span class="toc-text">第一种</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D"><span class="toc-text">第二种</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E5%89%8D%E9%9C%80%E8%A6%81%E5%87%86%E5%A4%87%E7%9A%84"><span class="toc-text">提前需要准备的</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-text">安装步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%8A%8Anginx%E7%9A%84%E6%BA%90%E7%A0%81%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%88%B0linux%E7%B3%BB%E7%BB%9F"><span class="toc-text">第一步：把nginx的源码包上传到linux系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%A7%A3%E5%8E%8B%E7%BC%A9"><span class="toc-text">第二步：解压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BD%BF%E7%94%A8configure%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E4%B8%80makeFile%E6%96%87%E4%BB%B6%E3%80%82"><span class="toc-text">第三步：使用configure命令创建一makeFile文件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5-%E4%B8%8A%E4%B8%80%E6%AD%A5%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%8A%A5%E9%94%99%EF%BC%8C%E5%9B%A0%E4%B8%BA%E7%BC%BA%E5%B0%91temp%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%88%9B%E5%BB%BA%E5%8D%B3%E5%8F%AF"><span class="toc-text">第四步 上一步可能会报错，因为缺少temp文件，如下创建即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5-make"><span class="toc-text">第五步 make</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5-make-install"><span class="toc-text">第六步 make install</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AFnginx"><span class="toc-text">开启nginx</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-nginx%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3. nginx常用命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-nginx%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">4.nginx的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98"><span class="toc-text">4.1 反向代理实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%B0%8F%E7%BB%93"><span class="toc-text">4.2 反向代理小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E6%88%98"><span class="toc-text">4.3 负载均衡实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%AE%9E%E6%88%98"><span class="toc-text">4.4 动静分离实战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-nginx%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-text">5.nginx高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E5%AE%89%E8%A3%85keepalived"><span class="toc-text">5.1安装keepalived</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-text">6.原理解析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-text">小结</span></a></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>分类</div>
  <div class="categories-list">
    
      <a href="/categories/me">
        <div class="categories-list-item">
          me
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Linux">
        <div class="categories-list-item">
          Linux
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/Redis">
        <div class="categories-list-item">
          Redis
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>热门标签</div>
  <div class="tags-list">
    
    <a href="\tags\nginx" title="nginx"><div class="tags-list-item">nginx</div></a>
    
    <a href="\tags\数据类型" title="数据类型"><div class="tags-list-item">数据类型</div></a>
    
    <a href="\tags\Redis" title="Redis"><div class="tags-list-item">Redis</div></a>
    
    <a href="\tags\表单验证" title="表单验证"><div class="tags-list-item">表单验证</div></a>
    
    <a href="\tags\表格" title="表格"><div class="tags-list-item">表格</div></a>
    
    <a href="\tags\jQuery" title="jQuery"><div class="tags-list-item">jQuery</div></a>
    
    <a href="\tags\其他" title="其他"><div class="tags-list-item">其他</div></a>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">
  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Nginx%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="toc-text">1.Nginx知识网结构图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-text">1.1反向代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">1.2负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="toc-text">1.3动静分离</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-nginx%E5%A6%82%E4%BD%95%E5%9C%A8linux%E5%AE%89%E8%A3%85"><span class="toc-text">2. nginx如何在linux安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D"><span class="toc-text">第一种</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D"><span class="toc-text">第二种</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E5%89%8D%E9%9C%80%E8%A6%81%E5%87%86%E5%A4%87%E7%9A%84"><span class="toc-text">提前需要准备的</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-text">安装步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%8A%8Anginx%E7%9A%84%E6%BA%90%E7%A0%81%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%88%B0linux%E7%B3%BB%E7%BB%9F"><span class="toc-text">第一步：把nginx的源码包上传到linux系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%A7%A3%E5%8E%8B%E7%BC%A9"><span class="toc-text">第二步：解压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BD%BF%E7%94%A8configure%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E4%B8%80makeFile%E6%96%87%E4%BB%B6%E3%80%82"><span class="toc-text">第三步：使用configure命令创建一makeFile文件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5-%E4%B8%8A%E4%B8%80%E6%AD%A5%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%8A%A5%E9%94%99%EF%BC%8C%E5%9B%A0%E4%B8%BA%E7%BC%BA%E5%B0%91temp%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%88%9B%E5%BB%BA%E5%8D%B3%E5%8F%AF"><span class="toc-text">第四步 上一步可能会报错，因为缺少temp文件，如下创建即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5-make"><span class="toc-text">第五步 make</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5-make-install"><span class="toc-text">第六步 make install</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AFnginx"><span class="toc-text">开启nginx</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-nginx%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3. nginx常用命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-nginx%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">4.nginx的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98"><span class="toc-text">4.1 反向代理实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%B0%8F%E7%BB%93"><span class="toc-text">4.2 反向代理小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E6%88%98"><span class="toc-text">4.3 负载均衡实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%AE%9E%E6%88%98"><span class="toc-text">4.4 动静分离实战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-nginx%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-text">5.nginx高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E5%AE%89%E8%A3%85keepalived"><span class="toc-text">5.1安装keepalived</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-text">6.原理解析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-text">小结</span></a></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>最近文章</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-12-03</div>
        <a href="/2020/12/03/Redis 的 8 大数据类型/"><div class="recent-posts-item-content">Redis</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-12-02</div>
        <a href="/2020/12/02/搞懂Nginx/"><div class="recent-posts-item-content">弄懂nginx</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-11-26</div>
        <a href="/2020/11/26/hexo搭建个人博客/"><div class="recent-posts-item-content">hexo框架搭建个人博客</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-11-20</div>
        <a href="/2020/11/20/Linux安装mysql/"><div class="recent-posts-item-content">Linux安装mysql（mysql-5.7.23-1.el7.x86_64.rpm-bundle.tar）（万能解决登录问题，最详细教程）</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2020 -
          
          2020
        </span>
        &nbsp;
        <a href="/" class="footer-link">theme-kaze demo </a>
      </div>
    </div>

    
    <div class="footer-dsc">
      
      Powered by
      <a href="https://hexo.io/" class="footer-link" target="_blank" rel="nofollow noopener noreferrer">&nbsp;Hexo </a>
      
      
      <span>&nbsp;|&nbsp;</span>
      
      
      Theme -
      <a href="https://github.com/theme-kaze" class="footer-link" target="_blank"
        rel="nofollow noopener noreferrer">&nbsp;Kaze</a>
      
    </div>
    
    
    
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton"  aria-label="回到顶部">
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton" aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget" aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a role="button" id="searchbutton" class="basebutton searchwidget" aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a>

  
  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.setAttribute('aria-label', 'illustration');
      wrapper.style.cssText = 'width: 100%; display: flex; justify-content: center;';
      if (img[i].alt) wrapper.dataset.caption = img[i].alt;
      wrapper.dataset.nolink = true;
      img[i].before(wrapper);
      wrapper.append(img[i]);
      var divWrap = document.createElement('div');
      divWrap.classList.add('gallery');
      wrapper.before(divWrap);
      divWrap.append(wrapper);
    }
    baguetteBox.run('.gallery');
  }
</script>
<script>loadScript("/js/lib/lightbox/baguetteBox.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
</body>

</html>